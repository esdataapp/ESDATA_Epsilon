Te dejo una revisión quirúrgica: lo que está sólido, los huecos que conviene cerrar y un plan corto de ajustes.

Qué está muy bien

Arquitectura en 3 capas (Python batch → API con caché → front interactivo). Eso habilita respuesta rápida sin inflar el cliente. 

PLAN_DASHBOARD_ZMG_COMPLETO

UX mobile-first con bottom tabs y vistas: Inicio, Explorar, Segmentos, Analítica. Cubre las preguntas de negocio correctas. 

PLAN_DASHBOARD_ZMG_COMPLETO

Stack y organización de front (Vite/React/TS, shadcn/ui, Recharts, Zustand, TanStack Query) + estructura de componentes clara. 

PLAN_DASHBOARD_ZMG_COMPLETO

 

ESTRUCTURA_PROYECTO

Capa de cache y vistas materializadas planteadas (Redis + MVs). Bien pensado para “hot paths”. 

ARQUITECTURA_TECNICA

Roadmap por semanas es realista y prioriza M1 correcto (KPIs + filtros + endpoints básicos). 

PLAN_DASHBOARD_ZMG_COMPLETO

Riesgos / gaps a corregir pronto

Tipo geoespacial inconsistente
En listings_processed usas location POINT pero luego indizas con GiST como si fuera PostGIS geometry. Cámbialo a geometry(Point, 4326) (o geography(Point,4326) si prefieres distancias) para que el índice funcione y Mapbox se beneficie. 

ARQUITECTURA_TECNICA

Históricos y series
market_stats no guarda periodo (solo calculation_date). Así solo tendrás “la foto actual”. Agrega period_month DATE (o YYYY-MM) y mételo en la UNIQUE(...) para poder graficar tendencias y deltas por colonia/segmento. 

ARQUITECTURA_TECNICA

Histogramas “pre-cocinados”
En las vistas aparece histograma, pero no hay endpoint ni tabla de bins. Sugiero /api/stats/hist + tabla bins con cortes por segmento (p10-p90, Freedman-Diaconis) para no recalcular en el cliente. 

PLAN_DASHBOARD_ZMG_COMPLETO

Correlaciones/Clusters incompletos
Tienes el hook en Python pero en “TODO”. Define la granularidad mínima (ZMG × tipo_propiedad × operación; luego municipio/colonia con n≥30) y persiste matrices y etiquetas legibles. 

ARQUITECTURA_TECNICA

Amenidades sin métrica de impacto
Falta una tabla amenity_lift (lift %, CI, n) para soportar la vista de “Estudio de amenidades” y ordenar por impacto real, no frecuencia.

Invalidez de caché
Está el TTL, pero no la política de invalidación post-ETL (cada 15 días). Suma ETag/If-None-Match y “versionado” por data_version=vYYYYMMDD para coherencia entre front y API. 

PLAN_DASHBOARD_ZMG_COMPLETO

Búsqueda de colonias
Añade índice trigram/FTS para autocompletar colonias con debounce; mejora mucho la fricción en móvil. (Relacionado a estructura de front con ColonySearch.) 

ESTRUCTURA_PROYECTO

Ajustes de alto impacto / bajo esfuerzo (una tarde bien enfocada)

Schema geo: location geometry(Point,4326) + USING GIST(location); valida SRID al cargar. 

ARQUITECTURA_TECNICA

Time-series: agrega period_month DATE en market_stats + @@unique([geo_level, geo_id, property_type, operation, period_month]). 

ARQUITECTURA_TECNICA

Tabla bins + endpoint /api/stats/hist para precio, superficie y PxM2 por (geo, tipo, operación). (La vista lo pide.) 

PLAN_DASHBOARD_ZMG_COMPLETO

corr_mats: precalcula Spearman y Cramer’s V por segmento con n≥30; guarda top-parejas (|ρ|) para heatmap rápido. 

ARQUITECTURA_TECNICA

amenity_lift: Lasso por segmento → guarda lift_%, ci_low/ci_high, support. Úsalo para ranking.

Cache keys: stats:filtered:{hash(filters)+period_month}; expón cached: true/false en meta. 

ARQUITECTURA_TECNICA

UI de filtros: chips visibles + badge “Actualizado: AAAA-MM-DD” (trae last_update en /overview). 

ARQUITECTURA_TECNICA

Micro-desacoples y naming

Unifica nombres entre docs: usas surface_m2 / surface_built_m2 y price_per_sqm / pxm2. Define uno y documenta diccionario. 

PLAN_DASHBOARD_ZMG_COMPLETO

 

ARQUITECTURA_TECNICA

En front, mantén wrappers de Recharts por tipo (ya los listaste) para estilos consistentes. Bien ahí. 

ESTRUCTURA_PROYECTO

Validación de la narrativa (datos → historia)

Inicio debe responder: “¿Cómo va hoy el mercado?” (KPIs + variación 30/90d + 3 insights accionables). Lo tienes contemplado. 

PLAN_DASHBOARD_ZMG_COMPLETO

Explorar: mapa + lista + histograma con brush; perfecto para “tantear” rangos. 

PLAN_DASHBOARD_ZMG_COMPLETO

Segmentos: presets (1R/1–1.5B, 2R/2–2.5B, 3R/3–3.5B) y comparador. Solo asegúrate de devolver p25-p75, mediana y cobertura n. 

PLAN_DASHBOARD_ZMG_COMPLETO

Analítica: correlación, clústeres y amenidades con CI. La base técnica está, falta persistir resultados. 

ARQUITECTURA_TECNICA

Criterios de aceptación M0 (propuestos)

/api/stats/overview devuelve last_update, KPIs y top colonias (≤200 ms cacheado). 

ARQUITECTURA_TECNICA

/api/stats/hist sirve 20–40 bins por variable/segmento (pide cortes desde bins).

Filtros primarios (precio, tipo, operación, ubicación) y chips activos visibles. 

PLAN_DASHBOARD_ZMG_COMPLETO

Tabla market_stats con period_month poblada para ZMG y municipios.

Dos decisiones rápidas

¿Guardamos series mensuales a nivel colonia desde ya (n≥30) o empezamos por ZMG/municipio y bajamos después?

¿Prefieres geometry(Point,4326) o geography(Point,4326) para las consultas de distancia/vecindad iniciales?

Si te late, tomo esto y te preparo los cambios de esquema (ALTER TABLE + bins/corr/amenity_lift) y el contrato de los endpoints /hist y /corr listos para que los pegues en tu backend.